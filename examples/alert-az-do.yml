---
# Global defaults, applied to all receivers where not explicitly overridden. Optional.
defaults:
  # API access fields.
  organization: contoso
  # Get credentials from the environment variables.
  tenant_id: $(AZURE_TENANT_ID)
  subscription_id: $(AZURE_SUBSCRIPTION_ID)
  # Use generic credentials for all receivers.
  client_id: $(AZURE_CLIENT_ID)
  client_secret: $(AZURE_CLIENT_SECRET)
  # Alternatively to user and password use a Personal Access Token
  # See https://learn.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&tabs=Windows
  # personal_access_token: $(AZURE_PAT)

  # The type of Azure DevOps work item to create. Required.
  issue_type: Issue
  # Issue priority. Optional.
  priority: '{{ template "azdo.priority" . }}'
  # Go template invocation for generating the summary. Required.
  summary: '{{ template "azdo.summary" . }}'
  # Go template invocation for generating the description. Optional.
  description: '{{ template "azdo.description" . }}'
  # State to transition into when reopening a closed issue. Required.
  reopen_state: "Ready"
  # Do not reopen issues that are in this state. Optional.
  skip_reopen_state: "Removed"
  # Amount of time after being closed that an issue should be reopened, after which, a new issue is created.
  # Optional (default: always reopen)
  reopen_duration: 0h
  # Static label that will be added to the Azure DevOps work item alongside the alert-az-do{...} or ALERT{...} label
  static_labels: ["custom"]
  # Other projects are the projects to search for existing issues for the given alerts if
  # the main project does not have it. If no issue was found in, the main projects will
  # be used to create a new one. If the old issue is found in one of the other projects
  # (first found is used in case of duplicates) that old project's issue will be used for
  # alert updates instead of creating on in the main project.
  other_projects: ["OTHER1", "OTHER2"]
  # Azure DevOps area path. Optional.
  #area_path: "<area_path>"
  # Azure DevOps iteration path. Optional.
  #iteration_path: "<iteration_path>"
  # Standard or custom field values to set on created issue. Optional.
  #fields:
  #  - field: System.AssignedTo
  #    value: '{{ .alerts[0].labels["owner"] }}'
  # Automatically resolve Azure DevOps work items when alert is resolved. Optional. If declared, ensure state is not an empty string.
  auto_resolve:
    state: 'Completed'
  # Include ticket update as comment. Optional (default: false).
  update_in_comment: false

# Receiver definitions. At least one must be defined.
receivers:
    # Must match the Alertmanager receiver name. Required.
  - name: 'contoso-ab'
    # Azure DevOps project to create the issue in. Required.
    project: AB
    # Use receiver specific API access fields.
    client_id: $(AZURE_CLIENT_ID)
    client_secret: $(AZURE_CLIENT_SECRET)

    # Copy all Prometheus labels into separate Azure DevOps labels. Optional (default: false).
    add_group_labels: false
    # Include ticket update as comment too. Optional (default: false).
    update_in_comment: false
    # Will be merged with the static_labels from the default map
    static_labels: ["anotherLabel"]

  - name: 'contoso-xy'
    project: XY
    # Use receiver specific API access fields.
    personal_access_token: $(AZURE_PAT)
    # Overrides default.
    issue_type: Task
    # Azure DevOps area path. Optional.
    area_path: 'Datacenter\\Operations'
    # Azure DevOps iteration path. Optional.
    iteration_path: 'Datacenter'
    # Standard or custom field values to set on created issue. Optional.
    fields:
      System.AssignedTo: '{{ .alerts[0].labels["owner"] }}'
    #
    # Automatically resolve Azure DevOps issues when alert is resolved. Optional. If declared, ensure state is not an empty string.
    auto_resolve:
      state: 'Completed'
    # Include ticket update as comment too. Optional (default: false).
    update_in_comment: true

# File containing template definitions. Required.
template: alert-az-do.tmpl
